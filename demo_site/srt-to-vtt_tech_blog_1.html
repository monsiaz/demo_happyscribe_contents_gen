<!DOCTYPE html>
<html lang='en'>
<head>
  <meta charset='utf-8'>
  <title>Building a microservice to convert SRT to VTT with HappyScribe API - HappyScribe</title>
  <meta name='description' content='AI-generated page about subtitle conversion.'>
  <meta name='viewport' content='width=device-width,initial-scale=1'>
  <link rel='canonical' href='https://monsiaz.github.io/demo_happyscribe_contents_gen/srt-to-vtt_tech_blog_1.html'>
  <link rel='stylesheet' href='https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css'>
  <link rel='stylesheet' href='settings/web_assets/style.css'>
</head>
<body>
  <header class='topbar'>
     <div class='container topbar-inner'>
        <a class='brand' href='/'><img src='settings/web_assets/header.png' class='hero-img' alt='Header'></a>
     </div>
  </header>

  <main class='container'>
     <nav id='toc' class='toc'></nav>
     {
    "Authorization": f"Bearer {api_key}",
    "Content-Type": "application/json"
}
payload = {
    "transcription": {
        "tmp_url": "https://cdn.example.com/audio.mp3",
        "document_url": "https://cdn.example.com/subtitles.srt",
        "language": "en-US",
        "service": "alignment",
        "is_subtitle": True
    }
}
response = requests.post(
    "https://www.happyscribe.com/api/v1/transcriptions",
    json=payload,
    headers=headers
)
task_id = response.json().get("id")
print("Alignment task created:", task_id)
</code></pre>

<h2>How to poll for alignment status?</h2>

<pre><code># Bash script showing exponential backoff polling

TASK_ID="your_task_id"
API_KEY="YOUR_API_KEY"
STATE=""
RETRY=5

while [ "$STATE" != "automatic_done" ] && [ "$STATE" != "failed" ]; do
  RESP=$(curl -s -H "Authorization: Bearer $API_KEY" \
    "https://www.happyscribe.com/api/v1/transcriptions/$TASK_ID")
  STATE=$(echo "$RESP" | jq -r .state)
  if [ "$STATE" = "failed" ]; then
    echo "Alignment failed"; exit 1
  fi
  echo "Current state: $STATE"
  sleep $RETRY
  RETRY=$(( RETRY * 2 ))
  if [ $RETRY -gt 60 ]; then
    RETRY=60
  fi
done

echo "Alignment completed"
</code></pre>

<h2>How to export the subtitle as VTT?</h2>

<pre><code># Node.js example for export request and download

const fetch = require("node-fetch");
const fs = require("fs");

const apiKey = "YOUR_API_KEY";
const taskId = "your_task_id";

async function exportVtt() {
  const exportResp = await fetch(
    "https://www.happyscribe.com/api/v1/exports",
    {
      method: "POST",
      headers: {
        "Authorization": `Bearer ${apiKey}`,
        "Content-Type": "application/json"
      },
      body: JSON.stringify({
        export: {
          format: "vtt",
          transcription_ids: [taskId]
        }
      })
    }
  );
  const expData = await exportResp.json();
  const expId = expData.id;

  // Poll until ready
  let state = "";
  while (state !== "ready") {
    const status = await fetch(
      `https://www.happyscribe.com/api/v1/exports/${expId}`,
      { headers: { "Authorization": `Bearer ${apiKey}` } }
    );
    const statData = await status.json();
    state = statData.state;
    if (state === "ready") {
      const dlLink = statData.download_link;
      const file = await fetch(dlLink);
      const buffer = await file.buffer();
      fs.writeFileSync("output.vtt", buffer);
      console.log("File saved as output.vtt");
      break;
    }
    await new Promise(r => setTimeout(r, 5000));
  }
}
     
  </main>

  <footer>
     <div class='container small text-muted'>© HappyScribe · Generated by <strong>o4-mini-2025-04-16</strong></div>
  </footer>

  <script src='https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js'></script>
  <script>
  document.addEventListener('DOMContentLoaded', () => {
     const toc = document.getElementById('toc');
     if (!toc) return;
     const h2s = Array.from(document.querySelectorAll('main.container h2'));
     if (!h2s.length) { toc.remove(); return; }
     const ul = document.createElement('ul');
     h2s.forEach(h => {
        const id = h.textContent.trim().toLowerCase().replace(/[^a-z0-9]+/g,'-');
        h.id = id;
        const li = document.createElement('li');
        li.innerHTML = "<a href='#"+id+"'>"+h.textContent+"</a>";
        ul.appendChild(li);
     });
     toc.innerHTML = '<h2>Table of contents</h2>';
     toc.appendChild(ul);
  });
  </script>
</body>
</html>